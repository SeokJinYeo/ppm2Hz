x=[1:80]-(1+80)/2;
y=[1:40]-(1+40)/2;
z=[1:20]-(1+20)/2;
[xx,yy,zz] = meshgrid(x,y,z);
S = (xx.^2)/1600 + (yy.^2)/400 + (zz.^2)/100 <=1;
dr = [0.001 0.001 0.001];
r = [0 0 0];
t = [40 80 20];
n = [0 1/2 sqrt(3)/2];
l = [0 1/2 sqrt(3)/2];
b0ellip = ellipsoid_field3(80,40,20,n,l,S,3);
ellipanalytical = b0ellip(20,40,10);
tic;
b0  = ppm2Hznl(S,dr,r,t,n,l,3);
time = toc;
tic;
b01 = ppm2Hznl_KD2(S,dr,1,2,n,l,3);
time1 = toc;
tic;
b02 = ppm2Hznl_KD2(S,dr,2,2,n,l,3);
time2 = toc;
tic;
b03 = ppm2Hznl_KD2(S,dr,1,8,n,l,3);
time3 = toc;
tic;
b04 = ppm2Hznl_KD2(S,dr,2,8,n,l,3);
time4 = toc;
%{
maxdiff1 = min(squeeze(b0(20, 5:75, 10)))-b0ellip(20,40,10);
maxdiff2 = max(squeeze(b0(20, 5:75, 10)))-b0ellip(20,40,10);
realmax = max(abs(maxdiff1),abs(maxdiff2));
maxdiff1 = min(squeeze(b01(20, 5:75, 10)))-b0ellip(20,40,10);
maxdiff2 = max(squeeze(b01(20, 5:75, 10)))-b0ellip(20,40,10);
realmax1 = max(abs(maxdiff1),abs(maxdiff2));
maxdiff1 = min(squeeze(b02(20, 5:75, 10)))-b0ellip(20,40,10);
maxdiff2 = max(squeeze(b02(20, 5:75, 10)))-b0ellip(20,40,10);
realmax2 = max(abs(maxdiff1),abs(maxdiff2));
maxdiff1 = min(squeeze(b03(20, 5:75, 10)))-b0ellip(20,40,10);
maxdiff2 = max(squeeze(b03(20, 5:75, 10)))-b0ellip(20,40,10);
realmax3 = max(abs(maxdiff1),abs(maxdiff2));
maxdiff1 = min(squeeze(b04(20, 5:75, 10)))-b0ellip(20,40,10);
maxdiff2 = max(squeeze(b04(20, 5:75, 10)))-b0ellip(20,40,10);
realmax4 = max(abs(maxdiff1),abs(maxdiff2));
%}
%{
y=squeeze(b0(20, :, 10));
x=[1:80]-(1+80)/2;
figure; plot(x,y);
axis([-40 40 -20 20]);
%axis([-40 40 -40 0]);
xlabel('x[mm]');
xticks([-40 -20 0 20 40]);
ylabel('B_{0}[Hz]');
yticks([-20 -10 0 10 20]);
%yticks([-40 -30 -20 -10 0]);
hold on;
fplot(ellipanalytical,[-40,40],'r--');
set(gca,'FontSize',23);

y=squeeze(b01(20, :, 10));
x=[1:80]-(1+80)/2;
figure; plot(x,y);
%axis([-40 40 -20 20]);
axis([-40 40 -40 0]);
xlabel('x[mm]');
xticks([-40 -20 0 20 40]);
ylabel('B_{0}[Hz]');
%yticks([-20 -10 0 10 20]);
yticks([-40 -30 -20 -10 0]);
hold on;
fplot(ellipanalytical,[-40,40],'r--');
set(gca,'FontSize',23);

y=squeeze(b01(:,40, 10));
x=[1:40]-(1+40)/2;
figure; plot(x,y);
%axis([-40 40 -20 20]);
axis([-20 20 -40 0]);
xlabel('y[mm]');
xticks([-20 -10 0 10 20]);
ylabel('B_{0}[Hz]');
%yticks([-20 -10 0 10 20]);
yticks([-40 -30 -20 -10 0]);
hold on;
fplot(ellipanalytical,[-20,20],'r--');
set(gca,'FontSize',23);

y=squeeze(b02(20,40,:));
x=[1:20]-(1+20)/2;
figure; plot(x,y);
%axis([-40 40 -20 20]);
axis([-10 10 -40 0]);
xlabel('z[mm]');
xticks([-10 -5 0 5 10]);
ylabel('B_{0}[Hz]');
%yticks([-20 -10 0 10 20]);
yticks([-40 -30 -20 -10 0]);
hold on;
fplot(ellipanalytical,[-20,20],'r--');
set(gca,'FontSize',23);

y=squeeze(b02(20, :, 10));
x=[1:80]-(1+80)/2;
figure; plot(x,y);
axis([-40 40 -20 20]);
%axis([-40 40 -40 0]);
xlabel('x[mm]');
xticks([-40 -20 0 20 40]);
ylabel('B_{0}[Hz]');
yticks([-20 -10 0 10 20]);
%yticks([-40 -30 -20 -10 0]);
hold on;
fplot(ellipanalytical,[-40,40],'r--');
set(gca,'FontSize',23);

y=squeeze(b03(20, :, 10));
x=[1:80]-(1+80)/2;
figure; plot(x,y);
axis([-40 40 -20 20]);
%axis([-40 40 -40 0]);
xlabel('x[mm]');
xticks([-40 -20 0 20 40]);
ylabel('B_{0}[Hz]');
yticks([-20 -10 0 10 20]);
%yticks([-40 -30 -20 -10 0]);
hold on;
fplot(ellipanalytical,[-40,40],'r--');
set(gca,'FontSize',23);

y=squeeze(b04(20, :, 10));
x=[1:80]-(1+80)/2;
figure;     plot(x,y);
axis([-40 40 -20 20]);
%axis([-40 40 -40 0]);
xlabel('x[mm]');
xticks([-40 -20 0 20 40]);
ylabel('B_{0}[Hz]');
yticks([-20 -10 0 10 20]);
%yticks([-40 -30 -20 -10 0]);
hold on;
fplot(ellipanalytical,[-40,40],'r--');
set(gca,'FontSize',23);
%}

